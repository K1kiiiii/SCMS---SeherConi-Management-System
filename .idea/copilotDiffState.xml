<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/scms/config/DatabaseConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/scms/config/DatabaseConfig.java" />
              <option name="originalContent" value="package com.scms.config;&#10;&#10;import com.scms.util.PasswordUtil;&#10;&#10;import java.sql.*;&#10;&#10;public class DatabaseConfig {&#10;    private static final String HOST = &quot;localhost&quot;;&#10;    private static final int PORT = 3306;&#10;    private static final String DB_NAME = &quot;scms_db&quot;;&#10;&#10;    // Allow overriding DB credentials via environment variables to avoid committing secrets&#10;    private static final String DEFAULT_USER = &quot;root&quot;;&#10;    private static final String DEFAULT_PASS = &quot;Auth_*#13wow&quot;; // fallback; prefer env var&#10;    private static final String USER;&#10;    private static final String PASS;&#10;&#10;    static {&#10;        String envUser = System.getenv(&quot;SCMS_DB_USER&quot;);&#10;        String envPass = System.getenv(&quot;SCMS_DB_PASS&quot;);&#10;        USER = (envUser != null &amp;&amp; !envUser.isBlank()) ? envUser : DEFAULT_USER;&#10;        PASS = (envPass != null) ? envPass : DEFAULT_PASS;&#10;    }&#10;&#10;    private static final String BASE_URL = &quot;jdbc:mysql://&quot; + HOST + &quot;:&quot; + PORT + &quot;/?serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;;&#10;&#10;    public static void initDatabase() {&#10;        try {&#10;            // 1) Connect to server (no DB) to create DB if not exists&#10;            try (Connection conn = DriverManager.getConnection(BASE_URL, USER, PASS);&#10;                 Statement st = conn.createStatement()) {&#10;                st.executeUpdate(&quot;CREATE DATABASE IF NOT EXISTS &quot; + DB_NAME + &quot; CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;&quot;);&#10;            }&#10;&#10;            // 2) Connect to the created DB to create tables&#10;            String dbUrl = &quot;jdbc:mysql://&quot; + HOST + &quot;:&quot; + PORT + &quot;/&quot; + DB_NAME + &quot;?serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;;&#10;            try (Connection conn = DriverManager.getConnection(dbUrl, USER, PASS);&#10;                 Statement st = conn.createStatement()) {&#10;&#10;                // users table&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS users (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      username VARCHAR(100) NOT NULL UNIQUE,&#10;                      password_hash VARCHAR(128) NOT NULL,&#10;                      role VARCHAR(50) NOT NULL,&#10;                      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // roles table&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS roles (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      name VARCHAR(50) NOT NULL UNIQUE,&#10;                      description VARCHAR(255)&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // placeholder tables (materials, assignments)&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS materials (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      name VARCHAR(150) NOT NULL,&#10;                      quantity DOUBLE DEFAULT 0,&#10;                      unit VARCHAR(30),&#10;                      supplier VARCHAR(100),&#10;                      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS assignments (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      user_id INT,&#10;                      material_id INT,&#10;                      quantity DOUBLE,&#10;                      assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;                      status VARCHAR(50) DEFAULT 'CONFIRMED',&#10;                      notes TEXT,&#10;                      FOREIGN KEY (user_id) REFERENCES users(id),&#10;                      FOREIGN KEY (material_id) REFERENCES materials(id)&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // recipes and recipe_items&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS recipes (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      name VARCHAR(150) NOT NULL,&#10;                      description TEXT,&#10;                      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS recipe_items (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      recipe_id INT NOT NULL,&#10;                      material_id INT NOT NULL,&#10;                      quantity DOUBLE,&#10;                      unit VARCHAR(30),&#10;                      FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE,&#10;                      FOREIGN KEY (material_id) REFERENCES materials(id)&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // Insert default roles if not present&#10;                st.executeUpdate(&quot;INSERT IGNORE INTO roles (name, description) VALUES ('admin','Administrator'),('worker','Worker'),('storekeeper','Storekeeper');&quot;);&#10;&#10;                // Insert default admin user if not exists&#10;                String checkAdminSql = &quot;SELECT COUNT(*) FROM users WHERE username='admin'&quot;;&#10;                try (ResultSet rs = st.executeQuery(checkAdminSql)) {&#10;                    rs.next();&#10;                    if (rs.getInt(1) == 0) {&#10;                        String hashed = PasswordUtil.hashPassword(&quot;admin&quot;);&#10;                        try (PreparedStatement ps = conn.prepareStatement(&quot;INSERT INTO users (username, password_hash, role) VALUES (?, ?, ?)&quot;)) {&#10;                            ps.setString(1, &quot;admin&quot;);&#10;                            ps.setString(2, hashed);&#10;                            ps.setString(3, &quot;admin&quot;);&#10;                            ps.executeUpdate();&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            System.out.println(&quot;Database initialization completed (db=&quot; + DB_NAME + &quot;).&quot;);&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;Failed initializing database: &quot; + ex.getMessage());&#10;            ex.printStackTrace();&#10;        }&#10;    }&#10;&#10;    // glavna veza sa bazom podataka&#10;    public static Connection getConnection() throws SQLException {&#10;        String dbUrl = &quot;jdbc:mysql://&quot; + HOST + &quot;:&quot; + PORT + &quot;/&quot; + DB_NAME + &quot;?serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;;&#10;        return DriverManager.getConnection(dbUrl, USER, PASS);&#10;    }&#10;&#10;    // Helper for quick debugging from command line&#10;    public static void testConnection() {&#10;        try (Connection c = getConnection()) {&#10;            System.out.println(&quot;DB URL: &quot; + c.getMetaData().getURL());&#10;            System.out.println(&quot;DB Product: &quot; + c.getMetaData().getDatabaseProductName() + &quot; v&quot; + c.getMetaData().getDatabaseProductVersion());&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;DB test failed: &quot; + ex.getClass().getName() + &quot; - &quot; + ex.getMessage());&#10;            ex.printStackTrace();&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.scms.config;&#10;&#10;import com.scms.util.PasswordUtil;&#10;&#10;import java.sql.*;&#10;&#10;public class DatabaseConfig {&#10;    private static final String HOST = &quot;localhost&quot;;&#10;    private static final int PORT = 3306;&#10;    private static final String DB_NAME = &quot;scms_db&quot;;&#10;&#10;    // Allow overriding DB credentials via environment variables to avoid committing secrets&#10;    private static final String DEFAULT_USER = &quot;root&quot;;&#10;    private static final String DEFAULT_PASS = &quot;Auth_*#13wow&quot;; // fallback; prefer env var&#10;    private static final String USER;&#10;    private static final String PASS;&#10;&#10;    static {&#10;        String envUser = System.getenv(&quot;SCMS_DB_USER&quot;);&#10;        String envPass = System.getenv(&quot;SCMS_DB_PASS&quot;);&#10;        USER = (envUser != null &amp;&amp; !envUser.isBlank()) ? envUser : DEFAULT_USER;&#10;        PASS = (envPass != null) ? envPass : DEFAULT_PASS;&#10;    }&#10;&#10;    private static final String BASE_URL = &quot;jdbc:mysql://&quot; + HOST + &quot;:&quot; + PORT + &quot;/?serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;;&#10;&#10;    public static void initDatabase() {&#10;        try {&#10;            // 1) Connect to server (no DB) to create DB if not exists&#10;            try (Connection conn = DriverManager.getConnection(BASE_URL, USER, PASS);&#10;                 Statement st = conn.createStatement()) {&#10;                st.executeUpdate(&quot;CREATE DATABASE IF NOT EXISTS &quot; + DB_NAME + &quot; CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;&quot;);&#10;            }&#10;&#10;            // 2) Connect to the created DB to create tables&#10;            String dbUrl = &quot;jdbc:mysql://&quot; + HOST + &quot;:&quot; + PORT + &quot;/&quot; + DB_NAME + &quot;?serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;;&#10;            try (Connection conn = DriverManager.getConnection(dbUrl, USER, PASS);&#10;                 Statement st = conn.createStatement()) {&#10;&#10;                // users table&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS users (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      username VARCHAR(100) NOT NULL UNIQUE,&#10;                      password_hash VARCHAR(128) NOT NULL,&#10;                      role VARCHAR(50) NOT NULL,&#10;                      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // roles table&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS roles (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      name VARCHAR(50) NOT NULL UNIQUE,&#10;                      description VARCHAR(255)&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // placeholder tables (materials, assignments)&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS materials (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      name VARCHAR(150) NOT NULL,&#10;                      quantity DOUBLE DEFAULT 0,&#10;                      unit VARCHAR(30),&#10;                      supplier VARCHAR(100),&#10;                      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS assignments (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      user_id INT,&#10;                      material_id INT,&#10;                      quantity DOUBLE,&#10;                      assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;                      status VARCHAR(50) DEFAULT 'CONFIRMED',&#10;                      notes TEXT,&#10;                      FOREIGN KEY (user_id) REFERENCES users(id),&#10;                      FOREIGN KEY (material_id) REFERENCES materials(id)&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // recipes and recipe_items&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS recipes (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      name VARCHAR(150) NOT NULL,&#10;                      description TEXT,&#10;                      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                st.executeUpdate(&quot;&quot;&quot;&#10;                    CREATE TABLE IF NOT EXISTS recipe_items (&#10;                      id INT AUTO_INCREMENT PRIMARY KEY,&#10;                      recipe_id INT NOT NULL,&#10;                      material_id INT NOT NULL,&#10;                      quantity DOUBLE,&#10;                      unit VARCHAR(30),&#10;                      FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE,&#10;                      FOREIGN KEY (material_id) REFERENCES materials(id)&#10;                    ) ENGINE=InnoDB;&#10;                    &quot;&quot;&quot;);&#10;&#10;                // Insert default roles if not present&#10;                st.executeUpdate(&quot;INSERT IGNORE INTO roles (name, description) VALUES ('admin','Administrator'),('worker','Worker'),('storekeeper','Storekeeper');&quot;);&#10;&#10;                // Insert default admin user if not exists&#10;                String checkAdminSql = &quot;SELECT COUNT(*) FROM users WHERE username='admin'&quot;;&#10;                try (ResultSet rs = st.executeQuery(checkAdminSql)) {&#10;                    rs.next();&#10;                    if (rs.getInt(1) == 0) {&#10;                        String hashed = PasswordUtil.hashPassword(&quot;admin&quot;);&#10;                        try (PreparedStatement ps = conn.prepareStatement(&quot;INSERT INTO users (username, password_hash, role) VALUES (?, ?, ?)&quot;)) {&#10;                            ps.setString(1, &quot;admin&quot;);&#10;                            ps.setString(2, hashed);&#10;                            ps.setString(3, &quot;admin&quot;);&#10;                            ps.executeUpdate();&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;&#10;            System.out.println(&quot;Database initialization completed (db=&quot; + DB_NAME + &quot;).&quot;);&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;Failed initializing database: &quot; + ex.getMessage());&#10;            ex.printStackTrace();&#10;        }&#10;    }&#10;&#10;    // glavna veza sa bazom podataka&#10;    public static Connection getConnection() throws SQLException {&#10;        String dbUrl = &quot;jdbc:mysql://&quot; + HOST + &quot;:&quot; + PORT + &quot;/&quot; + DB_NAME + &quot;?serverTimezone=UTC&amp;allowPublicKeyRetrieval=true&quot;;&#10;        return DriverManager.getConnection(dbUrl, USER, PASS);&#10;    }&#10;&#10;    // Helper for quick debugging from command line&#10;    public static void testConnection() {&#10;        try (Connection c = getConnection()) {&#10;            System.out.println(&quot;DB URL: &quot; + c.getMetaData().getURL());&#10;            System.out.println(&quot;DB Product: &quot; + c.getMetaData().getDatabaseProductName() + &quot; v&quot; + c.getMetaData().getDatabaseProductVersion());&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;DB test failed: &quot; + ex.getClass().getName() + &quot; - &quot; + ex.getMessage());&#10;            ex.printStackTrace();&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/scms/dao/AssignmentDao.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/scms/dao/AssignmentDao.java" />
              <option name="originalContent" value="package com.scms.dao;&#10;&#10;import com.scms.config.DatabaseConfig;&#10;import com.scms.model.Assignment;&#10;import com.scms.util.ResultSetMapper;&#10;&#10;import java.sql.*;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;public class AssignmentDao {&#10;&#10;    public Assignment create(Assignment a) throws SQLException {&#10;        String selectQtySql = &quot;SELECT quantity FROM materials WHERE id = ? FOR UPDATE&quot;;&#10;        String updateQtySql = &quot;UPDATE materials SET quantity = quantity - ? WHERE id = ?&quot;;&#10;        String insertSql = &quot;INSERT INTO assignments (user_id, material_id, quantity) VALUES (?, ?, ?)&quot;;&#10;&#10;        try (Connection conn = DatabaseConfig.getConnection()) {&#10;            conn.setAutoCommit(false);&#10;            try {&#10;                // provjera dostupnosti sirovine&#10;                try (PreparedStatement psSelect = conn.prepareStatement(selectQtySql)) {&#10;                    psSelect.setInt(1, a.getMaterialId());&#10;                    try (ResultSet rs = psSelect.executeQuery()) {&#10;                        if (!rs.next()) throw new SQLException(&quot;Sirovina sa id=&quot; + a.getMaterialId()+&quot; ne postoji.&quot;);&#10;                        double available = rs.getDouble(1);&#10;                        if (available &lt; a.getQuantity()) {&#10;                            throw new SQLException(&quot;Nedovoljan broj zaliha na stanju. Dostupno=&quot; + available + &quot;, zatraženo=&quot; + a.getQuantity());&#10;                        }&#10;                    }&#10;                }&#10;                // ažuriranje količine sirovina&#10;                try (PreparedStatement psUpdate = conn.prepareStatement(updateQtySql)) {&#10;                    psUpdate.setDouble(1, a.getQuantity());&#10;                    psUpdate.setInt(2, a.getMaterialId());&#10;                    int updated = psUpdate.executeUpdate();&#10;                    if (updated &lt;= 0) throw new SQLException(&quot;Greška pri ažuriranju sirovine sa id=&quot; + a.getMaterialId());&#10;                }&#10;&#10;                try (PreparedStatement ps = conn.prepareStatement(insertSql, Statement.RETURN_GENERATED_KEYS)) {&#10;                    ps.setInt(1, a.getUserId());&#10;                    ps.setInt(2, a.getMaterialId());&#10;                    ps.setDouble(3, a.getQuantity());&#10;                    ps.executeUpdate();&#10;                    try (ResultSet keys = ps.getGeneratedKeys()) { if (keys.next()) a.setId(keys.getInt(1)); }&#10;                }&#10;&#10;                conn.commit();&#10;                return a;&#10;            } catch (SQLException ex) {&#10;                conn.rollback();&#10;                throw ex;&#10;            } finally {&#10;                conn.setAutoCommit(true);&#10;            }&#10;        }&#10;    }&#10;&#10;    // pending request (nece utjecat na stanje zaliha)&#10;    public Assignment createRequest(Assignment a) throws SQLException {&#10;        String insertSql = &quot;INSERT INTO assignments (user_id, material_id, quantity, status, notes) VALUES (?, ?, ?, ?, ?)&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(insertSql, Statement.RETURN_GENERATED_KEYS)) {&#10;            ps.setInt(1, a.getUserId());&#10;            ps.setInt(2, a.getMaterialId());&#10;            ps.setDouble(3, a.getQuantity());&#10;            ps.setString(4, a.getStatus());&#10;            ps.setString(5, a.getNotes());&#10;            ps.executeUpdate();&#10;            try (ResultSet keys = ps.getGeneratedKeys()) { if (keys.next()) a.setId(keys.getInt(1)); }&#10;            return a;&#10;        }&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; findById(int id) throws SQLException {&#10;        String sql = &quot;SELECT * FROM assignments WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, id);&#10;            try (ResultSet rs = ps.executeQuery()) { if (rs.next()) return Optional.of(ResultSetMapper.mapAssignment(rs)); }&#10;        }&#10;        return Optional.empty();&#10;    }&#10;&#10;    public List&lt;Assignment&gt; findByUserId(int userId) throws SQLException {&#10;        List&lt;Assignment&gt; list = new ArrayList&lt;&gt;();&#10;        String sql = &quot;SELECT * FROM assignments WHERE user_id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, userId);&#10;            try (ResultSet rs = ps.executeQuery()) { while (rs.next()) list.add(ResultSetMapper.mapAssignment(rs)); }&#10;        }&#10;        return list;&#10;    }&#10;&#10;    public List&lt;Assignment&gt; findAll() throws SQLException {&#10;        List&lt;Assignment&gt; list = new ArrayList&lt;&gt;();&#10;        String sql = &quot;SELECT * FROM assignments&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             Statement st = conn.createStatement();&#10;             ResultSet rs = st.executeQuery(sql)) {&#10;            while (rs.next()) list.add(ResultSetMapper.mapAssignment(rs));&#10;        }&#10;        return list;&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; update(Assignment a) throws SQLException {&#10;        String sql = &quot;UPDATE assignments SET user_id = ?, material_id = ?, quantity = ? WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, a.getUserId());&#10;            ps.setInt(2, a.getMaterialId());&#10;            ps.setDouble(3, a.getQuantity());&#10;            ps.setInt(4, a.getId());&#10;            int updated = ps.executeUpdate();&#10;            if (updated &gt; 0) return findById(a.getId());&#10;        }&#10;        return Optional.empty();&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; approveRequest(int assignmentId) throws SQLException {&#10;        String selectAssignmentSql = &quot;SELECT material_id, quantity, status FROM assignments WHERE id = ? FOR UPDATE&quot;;&#10;        String selectQtySql = &quot;SELECT quantity FROM materials WHERE id = ? FOR UPDATE&quot;;&#10;        String updateQtySql = &quot;UPDATE materials SET quantity = quantity - ? WHERE id = ?&quot;;&#10;        String updateAssignmentSql = &quot;UPDATE assignments SET status = 'CONFIRMED', assigned_at = CURRENT_TIMESTAMP WHERE id = ?&quot;;&#10;&#10;        try (Connection conn = DatabaseConfig.getConnection()) {&#10;            conn.setAutoCommit(false);&#10;            try {&#10;                int materialId;&#10;                double qty;&#10;                String status;&#10;&#10;                try (PreparedStatement ps = conn.prepareStatement(selectAssignmentSql)) {&#10;                    ps.setInt(1, assignmentId);&#10;                    try (ResultSet rs = ps.executeQuery()) {&#10;                        if (!rs.next()) throw new SQLException(&quot;Zahtjev sa id=&quot; + assignmentId+&quot; ne postoji.&quot;);&#10;                        materialId = rs.getInt(1);&#10;                        qty = rs.getDouble(2);&#10;                        status = rs.getString(3);&#10;                    }&#10;                }&#10;&#10;                if (status != null &amp;&amp; !status.equalsIgnoreCase(&quot;PENDING&quot;)) {&#10;                    throw new SQLException(&quot;Only PENDING requests can be approved. Current status=&quot; + status);&#10;                }&#10;&#10;                try (PreparedStatement psSelect = conn.prepareStatement(selectQtySql)) {&#10;                    psSelect.setInt(1, materialId);&#10;                    try (ResultSet rs = psSelect.executeQuery()) {&#10;                        if (!rs.next()) throw new SQLException(&quot;Tražena sirovina sa id=&quot; + materialId+&quot; ne postoji.&quot;);&#10;                        double available = rs.getDouble(1);&#10;                        if (available &lt; qty) throw new SQLException(&quot;Nema dovoljno sirovina na zalihi. Dostupno=&quot; + available + &quot;, zatraženo=&quot; + qty);&#10;                    }&#10;                }&#10;&#10;                try (PreparedStatement psUpdate = conn.prepareStatement(updateQtySql)) {&#10;                    psUpdate.setDouble(1, qty);&#10;                    psUpdate.setInt(2, materialId);&#10;                    int updated = psUpdate.executeUpdate();&#10;                    if (updated &lt;= 0) throw new SQLException(&quot;Neuspješno ažuriranje količine sirovine sa id=&quot; + materialId);&#10;                }&#10;&#10;                try (PreparedStatement ps = conn.prepareStatement(updateAssignmentSql)) {&#10;                    ps.setInt(1, assignmentId);&#10;                    int updated = ps.executeUpdate();&#10;                    if (updated &lt;= 0) throw new SQLException(&quot;Failed to update assignment status for id=&quot; + assignmentId);&#10;                }&#10;&#10;                conn.commit();&#10;                return findById(assignmentId);&#10;            } catch (SQLException ex) {&#10;                conn.rollback();&#10;                throw ex;&#10;            } finally {&#10;                conn.setAutoCommit(true);&#10;            }&#10;        }&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; rejectRequest(int assignmentId, String reason) throws SQLException {&#10;        String updateSql = &quot;UPDATE assignments SET status = 'REJECTED', notes = CONCAT(IFNULL(notes, ''), ?) WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(updateSql)) {&#10;            String appended = &quot;\n[REJECTED] &quot; + (reason != null ? reason : &quot;&quot;);&#10;            ps.setString(1, appended);&#10;            ps.setInt(2, assignmentId);&#10;            int updated = ps.executeUpdate();&#10;            if (updated &gt; 0) return findById(assignmentId);&#10;            return Optional.empty();&#10;        }&#10;    }&#10;&#10;    public boolean delete(int id) throws SQLException {&#10;        String sql = &quot;DELETE FROM assignments WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, id);&#10;            return ps.executeUpdate() &gt; 0;&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.scms.dao;&#10;&#10;import com.scms.config.DatabaseConfig;&#10;import com.scms.model.Assignment;&#10;import com.scms.util.ResultSetMapper;&#10;&#10;import java.sql.*;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;public class AssignmentDao {&#10;&#10;    public Assignment create(Assignment a) throws SQLException {&#10;        String selectQtySql = &quot;SELECT quantity FROM materials WHERE id = ? FOR UPDATE&quot;;&#10;        String updateQtySql = &quot;UPDATE materials SET quantity = quantity - ? WHERE id = ?&quot;;&#10;        String insertSql = &quot;INSERT INTO assignments (user_id, material_id, quantity) VALUES (?, ?, ?)&quot;;&#10;&#10;        try (Connection conn = DatabaseConfig.getConnection()) {&#10;            conn.setAutoCommit(false);&#10;            try {&#10;                // provjera dostupnosti sirovine&#10;                try (PreparedStatement psSelect = conn.prepareStatement(selectQtySql)) {&#10;                    psSelect.setInt(1, a.getMaterialId());&#10;                    try (ResultSet rs = psSelect.executeQuery()) {&#10;                        if (!rs.next()) throw new SQLException(&quot;Sirovina sa id=&quot; + a.getMaterialId()+&quot; ne postoji.&quot;);&#10;                        double available = rs.getDouble(1);&#10;                        if (available &lt; a.getQuantity()) {&#10;                            throw new SQLException(&quot;Nedovoljan broj zaliha na stanju. Dostupno=&quot; + available + &quot;, zatraženo=&quot; + a.getQuantity());&#10;                        }&#10;                    }&#10;                }&#10;                // ažuriranje količine sirovina&#10;                try (PreparedStatement psUpdate = conn.prepareStatement(updateQtySql)) {&#10;                    psUpdate.setDouble(1, a.getQuantity());&#10;                    psUpdate.setInt(2, a.getMaterialId());&#10;                    int updated = psUpdate.executeUpdate();&#10;                    if (updated &lt;= 0) throw new SQLException(&quot;Greška pri ažuriranju sirovine sa id=&quot; + a.getMaterialId());&#10;                }&#10;&#10;                try (PreparedStatement ps = conn.prepareStatement(insertSql, Statement.RETURN_GENERATED_KEYS)) {&#10;                    ps.setInt(1, a.getUserId());&#10;                    ps.setInt(2, a.getMaterialId());&#10;                    ps.setDouble(3, a.getQuantity());&#10;                    ps.executeUpdate();&#10;                    try (ResultSet keys = ps.getGeneratedKeys()) { if (keys.next()) a.setId(keys.getInt(1)); }&#10;                }&#10;&#10;                conn.commit();&#10;                return a;&#10;            } catch (SQLException ex) {&#10;                conn.rollback();&#10;                throw ex;&#10;            } finally {&#10;                conn.setAutoCommit(true);&#10;            }&#10;        }&#10;    }&#10;&#10;    // pending request (nece utjecat na stanje zaliha)&#10;    public Assignment createRequest(Assignment a) throws SQLException {&#10;        String insertSql = &quot;INSERT INTO assignments (user_id, material_id, quantity, status, notes) VALUES (?, ?, ?, ?, ?)&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(insertSql, Statement.RETURN_GENERATED_KEYS)) {&#10;            ps.setInt(1, a.getUserId());&#10;            ps.setInt(2, a.getMaterialId());&#10;            ps.setDouble(3, a.getQuantity());&#10;            ps.setString(4, a.getStatus());&#10;            ps.setString(5, a.getNotes());&#10;            ps.executeUpdate();&#10;            try (ResultSet keys = ps.getGeneratedKeys()) { if (keys.next()) a.setId(keys.getInt(1)); }&#10;            return a;&#10;        }&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; findById(int id) throws SQLException {&#10;        String sql = &quot;SELECT * FROM assignments WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, id);&#10;            try (ResultSet rs = ps.executeQuery()) { if (rs.next()) return Optional.of(ResultSetMapper.mapAssignment(rs)); }&#10;        }&#10;        return Optional.empty();&#10;    }&#10;&#10;    public List&lt;Assignment&gt; findByUserId(int userId) throws SQLException {&#10;        List&lt;Assignment&gt; list = new ArrayList&lt;&gt;();&#10;        String sql = &quot;SELECT * FROM assignments WHERE user_id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, userId);&#10;            try (ResultSet rs = ps.executeQuery()) { while (rs.next()) list.add(ResultSetMapper.mapAssignment(rs)); }&#10;        }&#10;        return list;&#10;    }&#10;&#10;    public List&lt;Assignment&gt; findAll() throws SQLException {&#10;        List&lt;Assignment&gt; list = new ArrayList&lt;&gt;();&#10;        String sql = &quot;SELECT * FROM assignments&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             Statement st = conn.createStatement();&#10;             ResultSet rs = st.executeQuery(sql)) {&#10;            while (rs.next()) list.add(ResultSetMapper.mapAssignment(rs));&#10;        }&#10;        return list;&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; update(Assignment a) throws SQLException {&#10;        String sql = &quot;UPDATE assignments SET user_id = ?, material_id = ?, quantity = ? WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, a.getUserId());&#10;            ps.setInt(2, a.getMaterialId());&#10;            ps.setDouble(3, a.getQuantity());&#10;            ps.setInt(4, a.getId());&#10;            int updated = ps.executeUpdate();&#10;            if (updated &gt; 0) return findById(a.getId());&#10;        }&#10;        return Optional.empty();&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; approveRequest(int assignmentId) throws SQLException {&#10;        String selectAssignmentSql = &quot;SELECT material_id, quantity, status FROM assignments WHERE id = ? FOR UPDATE&quot;;&#10;        String selectQtySql = &quot;SELECT quantity FROM materials WHERE id = ? FOR UPDATE&quot;;&#10;        String updateQtySql = &quot;UPDATE materials SET quantity = quantity - ? WHERE id = ?&quot;;&#10;        String updateAssignmentSql = &quot;UPDATE assignments SET status = 'CONFIRMED', assigned_at = CURRENT_TIMESTAMP WHERE id = ?&quot;;&#10;&#10;        try (Connection conn = DatabaseConfig.getConnection()) {&#10;            conn.setAutoCommit(false);&#10;            try {&#10;                int materialId;&#10;                double qty;&#10;                String status;&#10;&#10;                try (PreparedStatement ps = conn.prepareStatement(selectAssignmentSql)) {&#10;                    ps.setInt(1, assignmentId);&#10;                    try (ResultSet rs = ps.executeQuery()) {&#10;                        if (!rs.next()) throw new SQLException(&quot;Zahtjev sa id=&quot; + assignmentId+&quot; ne postoji.&quot;);&#10;                        materialId = rs.getInt(1);&#10;                        qty = rs.getDouble(2);&#10;                        status = rs.getString(3);&#10;                    }&#10;                }&#10;&#10;                if (status != null &amp;&amp; !status.equalsIgnoreCase(&quot;PENDING&quot;)) {&#10;                    throw new SQLException(&quot;Only PENDING requests can be approved. Current status=&quot; + status);&#10;                }&#10;&#10;                try (PreparedStatement psSelect = conn.prepareStatement(selectQtySql)) {&#10;                    psSelect.setInt(1, materialId);&#10;                    try (ResultSet rs = psSelect.executeQuery()) {&#10;                        if (!rs.next()) throw new SQLException(&quot;Tražena sirovina sa id=&quot; + materialId+&quot; ne postoji.&quot;);&#10;                        double available = rs.getDouble(1);&#10;                        if (available &lt; qty) throw new SQLException(&quot;Nema dovoljno sirovina na zalihi. Dostupno=&quot; + available + &quot;, zatraženo=&quot; + qty);&#10;                    }&#10;                }&#10;&#10;                try (PreparedStatement psUpdate = conn.prepareStatement(updateQtySql)) {&#10;                    psUpdate.setDouble(1, qty);&#10;                    psUpdate.setInt(2, materialId);&#10;                    int updated = psUpdate.executeUpdate();&#10;                    if (updated &lt;= 0) throw new SQLException(&quot;Neuspješno ažuriranje količine sirovine sa id=&quot; + materialId);&#10;                }&#10;&#10;                try (PreparedStatement ps = conn.prepareStatement(updateAssignmentSql)) {&#10;                    ps.setInt(1, assignmentId);&#10;                    int updated = ps.executeUpdate();&#10;                    if (updated &lt;= 0) throw new SQLException(&quot;Failed to update assignment status for id=&quot; + assignmentId);&#10;                }&#10;&#10;                conn.commit();&#10;                return findById(assignmentId);&#10;            } catch (SQLException ex) {&#10;                conn.rollback();&#10;                throw ex;&#10;            } finally {&#10;                conn.setAutoCommit(true);&#10;            }&#10;        }&#10;    }&#10;&#10;    public Optional&lt;Assignment&gt; rejectRequest(int assignmentId, String reason) throws SQLException {&#10;        String updateSql = &quot;UPDATE assignments SET status = 'REJECTED', notes = CONCAT(IFNULL(notes, ''), ?) WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(updateSql)) {&#10;            String appended = &quot;\n[REJECTED] &quot; + (reason != null ? reason : &quot;&quot;);&#10;            ps.setString(1, appended);&#10;            ps.setInt(2, assignmentId);&#10;            int updated = ps.executeUpdate();&#10;            if (updated &gt; 0) return findById(assignmentId);&#10;            return Optional.empty();&#10;        }&#10;    }&#10;&#10;    public boolean delete(int id) throws SQLException {&#10;        String sql = &quot;DELETE FROM assignments WHERE id = ?&quot;;&#10;        try (Connection conn = DatabaseConfig.getConnection();&#10;             PreparedStatement ps = conn.prepareStatement(sql)) {&#10;            ps.setInt(1, id);&#10;            return ps.executeUpdate() &gt; 0;&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/scms/service/AssignmentService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/scms/service/AssignmentService.java" />
              <option name="originalContent" value="package com.scms.service;&#10;&#10;import com.scms.dao.AssignmentDao;&#10;import com.scms.model.Assignment;&#10;&#10;import java.sql.SQLException;&#10;import java.util.List;&#10;&#10;public class AssignmentService {&#10;&#10;    private final AssignmentDao dao = new AssignmentDao();&#10;&#10;    public Assignment assignMaterial(int userId, int materialId, double qty) {&#10;        if (userId &lt;= 0) throw new ServiceException(&quot;user.invalid&quot;);&#10;        if (materialId &lt;= 0) throw new ServiceException(&quot;material.invalid&quot;);&#10;        if (qty &lt;= 0) throw new ServiceException(&quot;quantity.invalid&quot;);&#10;&#10;        try {&#10;            Assignment a = new Assignment();&#10;            a.setUserId(userId);&#10;            a.setMaterialId(materialId);&#10;            a.setQuantity(qty);&#10;            return dao.create(a);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri kreiranju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    // kreiranje zahtjeva&#10;    public Assignment requestMaterial(int userId, int materialId, double qty, String notes) {&#10;        if (userId &lt;= 0) throw new ServiceException(&quot;user.invalid&quot;);&#10;        if (materialId &lt;= 0) throw new ServiceException(&quot;material.invalid&quot;);&#10;        if (qty &lt;= 0) throw new ServiceException(&quot;quantity.invalid&quot;);&#10;&#10;        try {&#10;            Assignment a = new Assignment();&#10;            a.setUserId(userId);&#10;            a.setMaterialId(materialId);&#10;            a.setQuantity(qty);&#10;            a.setStatus(&quot;PENDING&quot;);&#10;            a.setNotes(notes);&#10;            return dao.createRequest(a);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri kreiranju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public Assignment getAssignment(int id) {&#10;        try {&#10;            return dao.findById(id).orElseThrow(() -&gt; new ServiceException(&quot;assignment.not_found&quot;));&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri dobavljanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public List&lt;Assignment&gt; listAssignmentsForUser(int userId) {&#10;        try {&#10;            return dao.findByUserId(userId);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri dobavljanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public List&lt;Assignment&gt; listAll() {&#10;        try {&#10;            return dao.findAll();&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri dobavljanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public Assignment approveRequest(int assignmentId) {&#10;        try {&#10;            return dao.approveRequest(assignmentId).orElseThrow(() -&gt; new ServiceException(&quot;assignment.not_found&quot;));&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri odobravanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public Assignment rejectRequest(int assignmentId, String reason) {&#10;        try {&#10;            return dao.rejectRequest(assignmentId, reason).orElseThrow(() -&gt; new ServiceException(&quot;assignment.not_found&quot;));&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri odbijanju zahtjeva&quot;, ex);&#10;&#10;        }&#10;    }&#10;&#10;    public void removeAssignment(int id) {&#10;        try {&#10;            if (!dao.delete(id)) throw new ServiceException(&quot;assignment.not_found&quot;);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri brisanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.scms.service;&#10;&#10;import com.scms.dao.AssignmentDao;&#10;import com.scms.model.Assignment;&#10;&#10;import java.sql.SQLException;&#10;import java.util.List;&#10;&#10;public class AssignmentService {&#10;&#10;    private final AssignmentDao dao = new AssignmentDao();&#10;&#10;    public Assignment assignMaterial(int userId, int materialId, double qty) {&#10;        if (userId &lt;= 0) throw new ServiceException(&quot;user.invalid&quot;);&#10;        if (materialId &lt;= 0) throw new ServiceException(&quot;material.invalid&quot;);&#10;        if (qty &lt;= 0) throw new ServiceException(&quot;quantity.invalid&quot;);&#10;&#10;        try {&#10;            Assignment a = new Assignment();&#10;            a.setUserId(userId);&#10;            a.setMaterialId(materialId);&#10;            a.setQuantity(qty);&#10;            return dao.create(a);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri kreiranju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    // kreiranje zahtjeva&#10;    public Assignment requestMaterial(int userId, int materialId, double qty, String notes) {&#10;        if (userId &lt;= 0) throw new ServiceException(&quot;user.invalid&quot;);&#10;        if (materialId &lt;= 0) throw new ServiceException(&quot;material.invalid&quot;);&#10;        if (qty &lt;= 0) throw new ServiceException(&quot;quantity.invalid&quot;);&#10;&#10;        try {&#10;            Assignment a = new Assignment();&#10;            a.setUserId(userId);&#10;            a.setMaterialId(materialId);&#10;            a.setQuantity(qty);&#10;            a.setStatus(&quot;PENDING&quot;);&#10;            a.setNotes(notes);&#10;            return dao.createRequest(a);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri kreiranju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public Assignment getAssignment(int id) {&#10;        try {&#10;            return dao.findById(id).orElseThrow(() -&gt; new ServiceException(&quot;assignment.not_found&quot;));&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri dobavljanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public List&lt;Assignment&gt; listAssignmentsForUser(int userId) {&#10;        try {&#10;            return dao.findByUserId(userId);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri dobavljanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public List&lt;Assignment&gt; listAll() {&#10;        try {&#10;            return dao.findAll();&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri dobavljanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public Assignment approveRequest(int assignmentId) {&#10;        try {&#10;            return dao.approveRequest(assignmentId).orElseThrow(() -&gt; new ServiceException(&quot;assignment.not_found&quot;));&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri odobravanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;&#10;    public Assignment rejectRequest(int assignmentId, String reason) {&#10;        try {&#10;            return dao.rejectRequest(assignmentId, reason).orElseThrow(() -&gt; new ServiceException(&quot;assignment.not_found&quot;));&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri odbijanju zahtjeva&quot;, ex);&#10;&#10;        }&#10;    }&#10;&#10;    public void removeAssignment(int id) {&#10;        try {&#10;            if (!dao.delete(id)) throw new ServiceException(&quot;assignment.not_found&quot;);&#10;        } catch (SQLException ex) {&#10;            throw new ServiceException(&quot;Greška pri brisanju zahtjeva&quot;, ex);&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/scms/util/ResultSetMapper.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/scms/util/ResultSetMapper.java" />
              <option name="originalContent" value="package com.scms.util;&#10;&#10;import com.scms.model.*;&#10;&#10;import java.sql.ResultSet;&#10;import java.sql.SQLException;&#10;import java.sql.Timestamp;&#10;&#10;public class ResultSetMapper {&#10;&#10;    public static User mapUser(ResultSet rs) throws SQLException {&#10;        User u = new User();&#10;        u.setId(rs.getInt(&quot;id&quot;));&#10;        u.setUsername(rs.getString(&quot;username&quot;));&#10;        try { u.setPasswordHash(rs.getString(&quot;password_hash&quot;)); } catch (SQLException ignored) {}&#10;        u.setRole(rs.getString(&quot;role&quot;));&#10;        return u;&#10;    }&#10;&#10;    public static Role mapRole(ResultSet rs) throws SQLException {&#10;        Role r = new Role();&#10;        r.setId(rs.getInt(&quot;id&quot;));&#10;        r.setName(rs.getString(&quot;name&quot;));&#10;        r.setDescription(rs.getString(&quot;description&quot;));&#10;        return r;&#10;    }&#10;&#10;    public static Material mapMaterial(ResultSet rs) throws SQLException {&#10;        Material m = new Material();&#10;        m.setId(rs.getInt(&quot;id&quot;));&#10;        m.setName(rs.getString(&quot;name&quot;));&#10;        m.setQuantity(rs.getDouble(&quot;quantity&quot;));&#10;        m.setUnit(rs.getString(&quot;unit&quot;));&#10;        m.setSupplier(rs.getString(&quot;supplier&quot;));&#10;        Timestamp t = rs.getTimestamp(&quot;updated_at&quot;);&#10;        if (t != null) m.setUpdatedAt(t.toLocalDateTime());&#10;        return m;&#10;    }&#10;&#10;    public static Assignment mapAssignment(ResultSet rs) throws SQLException {&#10;        Assignment a = new Assignment();&#10;        a.setId(rs.getInt(&quot;id&quot;));&#10;        a.setUserId(rs.getInt(&quot;user_id&quot;));&#10;        a.setMaterialId(rs.getInt(&quot;material_id&quot;));&#10;        a.setQuantity(rs.getDouble(&quot;quantity&quot;));&#10;        Timestamp t = rs.getTimestamp(&quot;assigned_at&quot;);&#10;        if (t != null) a.setAssignedAt(t.toLocalDateTime());&#10;        try { a.setStatus(rs.getString(&quot;status&quot;)); } catch (SQLException ignored) {}&#10;        try { a.setNotes(rs.getString(&quot;notes&quot;)); } catch (SQLException ignored) {}&#10;        return a;&#10;    }&#10;&#10;    public static Recipe mapRecipe(ResultSet rs) throws SQLException {&#10;        Recipe r = new Recipe();&#10;        r.setId(rs.getInt(&quot;id&quot;));&#10;        r.setName(rs.getString(&quot;name&quot;));&#10;        r.setDescription(rs.getString(&quot;description&quot;));&#10;        Timestamp t = rs.getTimestamp(&quot;created_at&quot;);&#10;        if (t != null) r.setCreatedAt(t.toLocalDateTime());&#10;        return r;&#10;    }&#10;&#10;    public static RecipeItem mapRecipeItem(ResultSet rs) throws SQLException {&#10;        RecipeItem ri = new RecipeItem();&#10;        ri.setId(rs.getInt(&quot;id&quot;));&#10;        ri.setRecipeId(rs.getInt(&quot;recipe_id&quot;));&#10;        ri.setMaterialId(rs.getInt(&quot;material_id&quot;));&#10;        ri.setQuantity(rs.getDouble(&quot;quantity&quot;));&#10;        ri.setUnit(rs.getString(&quot;unit&quot;));&#10;        return ri;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.scms.util;&#10;&#10;import com.scms.model.*;&#10;&#10;import java.sql.ResultSet;&#10;import java.sql.SQLException;&#10;import java.sql.Timestamp;&#10;&#10;public class ResultSetMapper {&#10;&#10;    public static User mapUser(ResultSet rs) throws SQLException {&#10;        User u = new User();&#10;        u.setId(rs.getInt(&quot;id&quot;));&#10;        u.setUsername(rs.getString(&quot;username&quot;));&#10;        try { u.setPasswordHash(rs.getString(&quot;password_hash&quot;)); } catch (SQLException ignored) {}&#10;        u.setRole(rs.getString(&quot;role&quot;));&#10;        return u;&#10;    }&#10;&#10;    public static Role mapRole(ResultSet rs) throws SQLException {&#10;        Role r = new Role();&#10;        r.setId(rs.getInt(&quot;id&quot;));&#10;        r.setName(rs.getString(&quot;name&quot;));&#10;        r.setDescription(rs.getString(&quot;description&quot;));&#10;        return r;&#10;    }&#10;&#10;    public static Material mapMaterial(ResultSet rs) throws SQLException {&#10;        Material m = new Material();&#10;        m.setId(rs.getInt(&quot;id&quot;));&#10;        m.setName(rs.getString(&quot;name&quot;));&#10;        m.setQuantity(rs.getDouble(&quot;quantity&quot;));&#10;        m.setUnit(rs.getString(&quot;unit&quot;));&#10;        m.setSupplier(rs.getString(&quot;supplier&quot;));&#10;        Timestamp t = rs.getTimestamp(&quot;updated_at&quot;);&#10;        if (t != null) m.setUpdatedAt(t.toLocalDateTime());&#10;        return m;&#10;    }&#10;&#10;    public static Assignment mapAssignment(ResultSet rs) throws SQLException {&#10;        Assignment a = new Assignment();&#10;        a.setId(rs.getInt(&quot;id&quot;));&#10;        a.setUserId(rs.getInt(&quot;user_id&quot;));&#10;        a.setMaterialId(rs.getInt(&quot;material_id&quot;));&#10;        a.setQuantity(rs.getDouble(&quot;quantity&quot;));&#10;        Timestamp t = rs.getTimestamp(&quot;assigned_at&quot;);&#10;        if (t != null) a.setAssignedAt(t.toLocalDateTime());&#10;        try { a.setStatus(rs.getString(&quot;status&quot;)); } catch (SQLException ignored) {}&#10;        try { a.setNotes(rs.getString(&quot;notes&quot;)); } catch (SQLException ignored) {}&#10;        return a;&#10;    }&#10;&#10;    public static Recipe mapRecipe(ResultSet rs) throws SQLException {&#10;        Recipe r = new Recipe();&#10;        r.setId(rs.getInt(&quot;id&quot;));&#10;        r.setName(rs.getString(&quot;name&quot;));&#10;        r.setDescription(rs.getString(&quot;description&quot;));&#10;        Timestamp t = rs.getTimestamp(&quot;created_at&quot;);&#10;        if (t != null) r.setCreatedAt(t.toLocalDateTime());&#10;        return r;&#10;    }&#10;&#10;    public static RecipeItem mapRecipeItem(ResultSet rs) throws SQLException {&#10;        RecipeItem ri = new RecipeItem();&#10;        ri.setId(rs.getInt(&quot;id&quot;));&#10;        ri.setRecipeId(rs.getInt(&quot;recipe_id&quot;));&#10;        ri.setMaterialId(rs.getInt(&quot;material_id&quot;));&#10;        ri.setQuantity(rs.getDouble(&quot;quantity&quot;));&#10;        ri.setUnit(rs.getString(&quot;unit&quot;));&#10;        return ri;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/com/scms/view/requests.fxml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/com/scms/view/requests.fxml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;?import javafx.geometry.Insets?&gt;&#10;&lt;?import javafx.scene.control.*?&gt;&#10;&lt;?import javafx.scene.layout.BorderPane?&gt;&#10;&lt;?import javafx.scene.layout.HBox?&gt;&#10;&#10;&lt;BorderPane xmlns=&quot;http://javafx.com/javafx/25&quot; xmlns:fx=&quot;http://javafx.com/fxml/1&quot;&#10;            fx:controller=&quot;com.scms.controller.RequestsController&quot;&gt;&#10;    &lt;top&gt;&#10;        &lt;HBox spacing=&quot;8&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;Label text=&quot;Zahtjevi&quot;/&gt;&#10;                &lt;ComboBox fx:id=&quot;statusFilter&quot; prefWidth=&quot;150&quot;/&gt;&#10;                &lt;Button text=&quot;Refresh&quot; onAction=&quot;#handleRefresh&quot;/&gt;&#10;            &lt;/children&gt;&#10;            &lt;BorderPane.margin&gt;&#10;                &lt;Insets top=&quot;10&quot; right=&quot;10&quot; bottom=&quot;10&quot; left=&quot;10&quot;/&gt;&#10;            &lt;/BorderPane.margin&gt;&#10;        &lt;/HBox&gt;&#10;    &lt;/top&gt;&#10;&#10;    &lt;center&gt;&#10;        &lt;TableView fx:id=&quot;requestsTable&quot;&gt;&#10;            &lt;columns&gt;&#10;                &lt;TableColumn fx:id=&quot;colId&quot; text=&quot;ID&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colUser&quot; text=&quot;Korisnik&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colMaterial&quot; text=&quot;Materijal&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colQuantity&quot; text=&quot;Količina&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colStatus&quot; text=&quot;Status&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colNotes&quot; text=&quot;Napomene&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colAssignedAt&quot; text=&quot;Vrijeme&quot;/&gt;&#10;            &lt;/columns&gt;&#10;        &lt;/TableView&gt;&#10;    &lt;/center&gt;&#10;&#10;    &lt;bottom&gt;&#10;        &lt;HBox spacing=&quot;8&quot; alignment=&quot;CENTER_RIGHT&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;Button fx:id=&quot;approveButton&quot; text=&quot;Odobri&quot; onAction=&quot;#handleApprove&quot;/&gt;&#10;                &lt;Button fx:id=&quot;rejectButton&quot; text=&quot;Odbij&quot; onAction=&quot;#handleReject&quot;/&gt;&#10;            &lt;/children&gt;&#10;            &lt;BorderPane.margin&gt;&#10;                &lt;Insets top=&quot;10&quot; right=&quot;10&quot; bottom=&quot;10&quot; left=&quot;10&quot;/&gt;&#10;            &lt;/BorderPane.margin&gt;&#10;        &lt;/HBox&gt;&#10;    &lt;/bottom&gt;&#10;&lt;/BorderPane&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;?import javafx.geometry.Insets?&gt;&#10;&lt;?import javafx.scene.control.*?&gt;&#10;&lt;?import javafx.scene.layout.BorderPane?&gt;&#10;&lt;?import javafx.scene.layout.HBox?&gt;&#10;&#10;&lt;BorderPane xmlns=&quot;http://javafx.com/javafx/25&quot; xmlns:fx=&quot;http://javafx.com/fxml/1&quot;&#10;            fx:controller=&quot;com.scms.controller.RequestsController&quot;&gt;&#10;    &lt;top&gt;&#10;        &lt;HBox spacing=&quot;8&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;Label text=&quot;Zahtjevi&quot;/&gt;&#10;                &lt;ComboBox fx:id=&quot;statusFilter&quot; prefWidth=&quot;150&quot;/&gt;&#10;                &lt;Button text=&quot;Refresh&quot; onAction=&quot;#handleRefresh&quot;/&gt;&#10;            &lt;/children&gt;&#10;            &lt;BorderPane.margin&gt;&#10;                &lt;Insets top=&quot;10&quot; right=&quot;10&quot; bottom=&quot;10&quot; left=&quot;10&quot;/&gt;&#10;            &lt;/BorderPane.margin&gt;&#10;        &lt;/HBox&gt;&#10;    &lt;/top&gt;&#10;&#10;    &lt;center&gt;&#10;        &lt;TableView fx:id=&quot;requestsTable&quot;&gt;&#10;            &lt;columns&gt;&#10;                &lt;TableColumn fx:id=&quot;colId&quot; text=&quot;ID&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colUser&quot; text=&quot;Korisnik&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colMaterial&quot; text=&quot;Materijal&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colQuantity&quot; text=&quot;Količina&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colStatus&quot; text=&quot;Status&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colNotes&quot; text=&quot;Napomene&quot;/&gt;&#10;                &lt;TableColumn fx:id=&quot;colAssignedAt&quot; text=&quot;Vrijeme&quot;/&gt;&#10;            &lt;/columns&gt;&#10;        &lt;/TableView&gt;&#10;    &lt;/center&gt;&#10;&#10;    &lt;bottom&gt;&#10;        &lt;HBox spacing=&quot;8&quot; alignment=&quot;CENTER_RIGHT&quot;&gt;&#10;            &lt;children&gt;&#10;                &lt;Button fx:id=&quot;approveButton&quot; text=&quot;Odobri&quot; onAction=&quot;#handleApprove&quot;/&gt;&#10;                &lt;Button fx:id=&quot;rejectButton&quot; text=&quot;Odbij&quot; onAction=&quot;#handleReject&quot;/&gt;&#10;            &lt;/children&gt;&#10;            &lt;BorderPane.margin&gt;&#10;                &lt;Insets top=&quot;10&quot; right=&quot;10&quot; bottom=&quot;10&quot; left=&quot;10&quot;/&gt;&#10;            &lt;/BorderPane.margin&gt;&#10;        &lt;/HBox&gt;&#10;    &lt;/bottom&gt;&#10;&lt;/BorderPane&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>